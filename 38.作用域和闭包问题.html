<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>作用域和闭包的问题</title>
</head>
<body>
</body>
<script>
// demo1
var a = 20;
function test(){
	var b = a+10;

	function innerTest(){
		var c = 10;
		return b+c;
	}

	return innerTest();
}

test();  // 40


//  闭包会阻止垃圾回收机制回收内存
var fn = null;
function foo(){
	var a = 2;
	function innerFoo (){
		// console.log(c);  // 这个c是在bar里面定义的，但是innerFoo视图想调用，会抛出错误
		console.log(a);
	}

	fn = innerFoo;

	console.log(fn) // 函数
}

function bar(){
	// var c = 100;
	fn();  // 2
}

foo();
bar();


// 隐蔽的闭包
function demo2(){
	function bar2(str){
		var h = 3000;  // this is a 作用域范围内的变量
		console.log(str)
	}

	function foo2(fn,string){
		// console.log(h)  // makeａ　mistake   但是阻止下面的执行
		fn(string)
		// console.log(h)  // makeａ　mistake

	}

	foo2(bar2,'this is closure')
}

demo2();   // this is closure


(function(){
	var a = 10;
	var b = 20;

	function add(num1,num2){
		var numl = num1 || a;
		var num2 = num2 || b;

		return num1+num2;
	}

	window.add = add;
})()

// 利用闭包，让循环中1,2,3,4,5依次输出
for(var i=1; i<6; i++ ){
	setTimeout(function(){
		console.log(i)
	},1000)
}   // 这样的情况只能够6

(function(){
	for(var i=1; i<6; i++ ){

	(function(index){
		setTimeout(function(){
			console.log(index)
		},1000)
	})(i)
}   // 输出1,2,3,4,5

})()
</script>
</html>